<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LibreWolf Patch Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
        }
        #sidebar {
            width: 250px;
            background-color: #f1f3f4;
            padding: 20px;
            overflow-y: auto;
        }
        #content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
        }
        h1 {
            color: #202124;
            font-size: 24px;
            margin-bottom: 20px;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            cursor: pointer;
            padding: 10px;
            margin-bottom: 5px;
            background-color: #fff;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        li:hover {
            background-color: #e8f0fe;
        }
        #patchContent {
            background-color: #fff;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 20px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        #patchInfo {
            margin-bottom: 10px;
            font-style: italic;
            color: #5f6368;
        }
        .selected {
            background-color: #e8f0fe;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <ul id="patchList"></ul>
    </div>
    <div id="content">
        <h1>Patch Contents</h1>
        <div id="patchInfo"></div>
        <div id="patchContent"></div>
    </div>

    <script>
        const patchList = document.getElementById('patchList');
        const patchInfo = document.getElementById('patchInfo');
        const patchContent = document.getElementById('patchContent');

        const baseUrl = 'https://codeberg.org/librewolf/source/raw/branch/main/';
        const patchesUrl = `${baseUrl}assets/patches.txt`;

        // Toggle between using hardcoded list (true) or fetching from URL (false)
        const useHardcodedList = true; // for testing purposes

        // Hardcoded content of patches.txt
        const hardcodedPatchesContent = `patches/allow-JXL-in-non-nightly-browser.patch
patches/allow-ubo-private-mode.patch
patches/bootstrap.patch
patches/context-menu.patch
patches/custom-ubo-assets-bootstrap-location.patch
patches/dbus_name.patch
patches/devtools-bypass.patch
patches/disable-data-reporting-at-compile-time.patch
patches/flatpak-autoconf.patch
patches/fullpage-translations-customization.patch
patches/fullpage-translations.patch
patches/hide-passwordmgr.patch
patches/librewolf-prefs.patch
patches/mozilla_dirs.patch
patches/msix.patch
patches/remove_addons.patch
patches/rust-gentoo-musl.patch
patches/sed-patches/allow-searchengines-non-esr.patch
patches/sed-patches/disable-pocket.patch
patches/sed-patches/stop-undesired-requests.patch
patches/ui-patches/allow_cookies_for_site.patch
patches/ui-patches/firefox-view.patch
patches/ui-patches/handlers.patch
patches/ui-patches/hide-default-browser.patch
patches/ui-patches/lw-logo-devtools.patch
patches/ui-patches/pref-naming.patch
patches/ui-patches/privacy-preferences.patch
patches/ui-patches/remove-branding-urlbar.patch
patches/ui-patches/remove-cfrprefs.patch
patches/ui-patches/remove-organization-policy-banner.patch
patches/ui-patches/rename-firefox-labs.patch
patches/ui-patches/website-appearance-ui-rfp.patch
patches/urlbarprovider-interventions.patch
patches/windows-theming-bug.patch`.trim();

        async function fetchPatchList() {
            if (useHardcodedList) {
                return hardcodedPatchesContent.split('\n').map(patch => patch.trim());
            } else {
                try {
                    const response = await fetch(patchesUrl);
                    if (!response.ok) throw new Error('Failed to fetch patch list');
                    const content = await response.text();
                    return content.split('\n').map(patch => patch.trim());
                } catch (error) {
                    console.error('Error fetching patch list:', error);
                    return [];
                }
            }
        }

        async function createPatchList() {
            const patches = await fetchPatchList();
            patches.forEach(patch => {
                const li = document.createElement('li');
                li.textContent = patch.split('/').pop(); // Display only the filename
                li.setAttribute('data-patch', patch); // Store full path as data attribute
                li.onclick = () => loadPatchContent(patch, li);
                patchList.appendChild(li);
            });
        }

        async function loadPatchContent(patch, listItem) {
            try {
                // Remove 'selected' class from all list items
                document.querySelectorAll('#patchList li').forEach(item => item.classList.remove('selected'));
                // Add 'selected' class to clicked item
                listItem.classList.add('selected');

                const response = await fetch(`${baseUrl}${patch}`);
                if (!response.ok) throw new Error('Failed to fetch patch content');
                const content = await response.text();
                const lastModified = response.headers.get('last-modified');
                patchInfo.textContent = `Patch: ${patch.split('/').pop()}
Last modified: ${lastModified || 'Unknown'}`;
                patchContent.textContent = content;
            } catch (error) {
                console.error('Error loading patch content:', error);
                patchContent.textContent = 'Error loading patch content. Please try again.';
            }
        }

        createPatchList();
    </script>
</body>
</html>
